<div id="chat-modal"
    class="hidden z-50  fixed inset-0 bg-[rgba(0,0,0,0.5)] bg-opacity-50 flex items-center justify-center">
    <div class="lg:w-1/2 w-full md:h-3/4 h-screen rounded-lg shadow-lg flex flex-col bg-white ">
        <!-- Header -->
        <div class="p-4 border-b flex justify-between">
            <h2 class="text-lg font-semibold">Chat</h2>
            <button hx-on:click="document.getElementById('chat-modal').classList.add('hidden')"
                class="text-gray-500 cursor-pointer">&times;</button>
        </div>

        <!-- Messages -->
        <div id="chat-messages" class="p-4 flex-1 overflow-y-auto flex flex-col space-y-2">
        </div>

        <div id="spinner" class="htmx-indicator relative z-20 flex items-center space-x-2 p-2">
            <span class="bg-gray-300 w-2 h-2 rounded-full animate-bounce"></span>
            <span class="bg-gray-300 w-2 h-2 rounded-full animate-bounce delay-150"></span>
            <span class="bg-gray-300 w-2 h-2 rounded-full animate-bounce delay-300"></span>
        </div>

        <!-- Input Form -->
        <form hx-post="{{ url_for('send_message') }}" hx-target="#chat-messages" hx-swap="beforeend"
            hx-indicator="#spinner" hx-on::after-request="smoothScrollToBottom(); clearInputField();"
            hx-on::before-request="clearInputField();" class="p-4 border-t flex">
            <input type="text" name="content" id="chat-input" required
                class="flex-1 border border-gray-400 rounded-l-xl p-2">
            <button type="submit"
                class="bg-gray-950 hover:bg-gray-800 text-white font-semibold px-6 py-2 rounded-r-xl cursor-pointer">Send</button>
        </form>

        <script>
            function smoothScrollToBottom() {
                let chatBox = document.getElementById("chat-messages");
                chatBox.scrollTo({ top: chatBox.scrollHeight, behavior: "smooth" });
            }

            function clearInputField() {
                document.getElementById("chat-input").value = "";
            }

            function showTypingIndicator() {
                let typingIndicator = document.getElementById("typing-indicator");
                let chatMessages = document.getElementById("chat-messages");

                if (typingIndicator) {
                    typingIndicator.classList.remove("hidden");
                    chatMessages.appendChild(typingIndicator);
                    smoothScrollToBottom();
                }
            }

            function hideTypingIndicator() {
                let typingIndicator = document.getElementById("typing-indicator");
                if (typingIndicator) {
                    typingIndicator.classList.add("hidden");
                }
            }

            function openChatModal() {
                let chatModal = document.getElementById("chat-modal");
                chatModal.classList.remove("hidden");

                setTimeout(() => {
                    smoothScrollToBottom();
                }, 100);
            }
        </script>

    </div>
</div>